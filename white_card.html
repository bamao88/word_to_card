<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ—¥æŠ¥å¡ç‰‡ç”Ÿæˆå™¨ - å°çº¢ä¹¦ç‰ˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background-color: #f5f5f5;
            color: #333333;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }
        
        .instructions {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: left;
            max-width: 600px;
            margin: 0 auto 20px;
            border: 1px solid #90caf9;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #1976d2;
        }
        
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
            color: #555555;
        }
        
        .export-btn {
            background-color: #ff4757;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(255, 71, 87, 0.3);
        }
        
        .export-btn:hover {
            background-color: #ff3742;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.4);
        }
        
        .export-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .canvas-method-btn {
            background-color: #2ed573;
            box-shadow: 0 2px 8px rgba(46, 213, 115, 0.3);
        }
        
        .canvas-method-btn:hover {
            background-color: #26d067;
            box-shadow: 0 4px 12px rgba(46, 213, 115, 0.4);
        }
        
        .status {
            margin-top: 15px;
            font-size: 14px;
            color: #666666;
            min-height: 20px;
        }
        
        .card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            margin-bottom: 50px;
        }
        
        .card-wrapper {
            text-align: center;
        }
        
        .preview-card {
            width: 300px;
            height: 400px;
            background-color: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            overflow: hidden;
            position: relative;
            border: 1px solid #e0e0e0;
        }
        
        .preview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border-color: #cccccc;
        }
        
        .preview-content {
            padding: 20px;
            font-size: 11px;
            line-height: 1.6;
            height: calc(100% - 60px);
            overflow: hidden;
            color: #333333;
            text-align: left;
        }
        
        .preview-page-number {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 12px;
            color: #999999;
        }
        
        .card-label {
            margin-top: 10px;
            font-size: 14px;
            color: #666666;
        }
        
        /* Canvasç»˜åˆ¶åŒºåŸŸ */
        #canvasContainer {
            position: fixed;
            left: -9999px;
            top: 0;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e0e0e0;
            border-top: 3px solid #ff4757;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="controls">
        <h2>ğŸ¨ AIæ—¥æŠ¥ - å°çº¢ä¹¦å¡ç‰‡ç”Ÿæˆå™¨</h2>
        
        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li>å¤åˆ¶æ­¤é¡µé¢çš„æ‰€æœ‰ä»£ç ï¼Œä¿å­˜ä¸º .html æ–‡ä»¶</li>
                <li>åœ¨æœ¬åœ°æµè§ˆå™¨æ‰“å¼€è¯¥æ–‡ä»¶</li>
                <li>ä¿®æ”¹JavaScriptä»£ç ä¸­çš„ subtitleï¼ˆå°æ ‡é¢˜ï¼‰å’Œ contentï¼ˆæ­£æ–‡ï¼‰å˜é‡</li>
                <li>ä½¿ç”¨æŒ‰é’®ç”Ÿæˆå’Œä¸‹è½½å›¾ç‰‡</li>
            </ol>
            <p style="margin: 10px 0; color: #666;">
                ğŸ’¡ æç¤ºï¼šå¦‚æœåœ¨Claudeä¸­æ— æ³•ä¸‹è½½ï¼Œè¯·åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ä½¿ç”¨
            </p>
        </div>
        
        <div style="margin-top: 20px;">
            <button class="export-btn canvas-method-btn" onclick="generateWithCanvas()">
                ä½¿ç”¨Canvasç”Ÿæˆå›¾ç‰‡ï¼ˆæ¨èï¼‰
            </button>
            <button class="export-btn" onclick="generateAllCanvasImages()">
                æ‰¹é‡ç”Ÿæˆæ‰€æœ‰å›¾ç‰‡
            </button>
        </div>
        
        <div class="status" id="status">å‡†å¤‡å°±ç»ª</div>
    </div>
    
    <div class="card-container" id="cardContainer"></div>
    <div id="canvasContainer">
        <canvas id="renderCanvas"></canvas>
    </div>
    
    <script>
        // ========== åœ¨è¿™é‡Œä¿®æ”¹æ‚¨çš„å†…å®¹ ==========
        // å°æ ‡é¢˜
        const subtitle = 'ã€æ·±åº¦å¯¹è¯ã€‘Eric Schmidtè°ˆAIæ—¶ä»£çš„ç³»ç»Ÿæ€§å¨èƒä¸æœºé‡';
        
        // æ­£æ–‡å†…å®¹
        const content = 'å‰Google CEO Eric Schmidtä¸ Link Ventures æŠ•èµ„äºº Dave Blundin çš„æ­¤æ¬¡å¯¹è¯ï¼Œæ—¢æ˜¯å¯¹æŠ€æœ¯è¶‹åŠ¿çš„è§£è¯»ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡å…³äºäº§å“æˆ˜ç•¥ã€ç¤¾ä¼šç»“æ„çš„æ€ç»´é£æš´ã€‚\n\n**1. æœ€å¤§çš„ç³»ç»Ÿæ€§å¨èƒï¼šAIæ­£åœ¨ä¾µèš€äººç±»çš„"ç›®çš„æ„Ÿ"**\nè¿™å¯èƒ½æ˜¯å¯¹äº§å“è®¾è®¡è€…æœ€æ·±åˆ»çš„è­¦ç¤ºã€‚SchmidtæŒ‡å‡ºï¼Œé£é™©ä¸åœ¨äºAIä¼šæš´åŠ›ç»Ÿæ²»ï¼Œè€Œåœ¨äºå®ƒä»¥"æ¸©å’Œã€æ¸è¿›ã€æ— å£°çš„æ–¹å¼"æ¥ç®¡æˆ‘ä»¬çš„æ„å¿—ã€‚å½“AIä¸ºæˆ‘ä»¬è§„åˆ’å¥½ä¸€åˆ‡"æœ€ä¼˜"è·¯å¾„æ—¶ï¼Œäººç±»ä¼šå› æŒ‘æˆ˜æ€§é€€åœºè€Œä¸§å¤±ä¸»åŠ¨æ€§ä¸åˆ¤æ–­åŠ›ï¼Œæœ€ç»ˆè¢«å›°åœ¨ç³»ç»Ÿæ„å»ºçš„"è™šæ‹Ÿèˆ’é€‚ç‰¢ç¬¼"ä¸­ã€‚å¤§å®¶åœ¨è®¾è®¡Agentæˆ–è‡ªåŠ¨åŒ–å·¥å…·æ—¶ï¼Œæ˜¯å¦ä¹Ÿæ€è€ƒè¿‡è¿™ä¸ªé—®é¢˜ï¼Ÿæˆ‘ä»¬æ˜¯åœ¨èµ‹èƒ½ç”¨æˆ·ï¼Œè¿˜æ˜¯åœ¨ä¸çŸ¥ä¸è§‰ä¸­å‰Šå¼±ä»–ä»¬çš„èƒ½åŠ¨æ€§ï¼Ÿè¿™å¯¹äºæˆ‘ä»¬è®¾è®¡AIäº§å“çš„äº¤äº’å’Œä¼¦ç†è¾¹ç•Œï¼Œä¹Ÿå¸¦æ¥äº†æ€è€ƒã€‚\n**2. AIæ—¶ä»£çœŸæ­£çš„æŠ¤åŸæ²³ï¼šæ„å»ºé«˜æ•ˆçš„"å­¦ä¹ é—­ç¯"**\nè¿™éƒ¨åˆ†æ˜¯ç»™æ‰€æœ‰äº§å“å’Œæˆ˜ç•¥åˆ¶å®šè€…çš„æ ¸å¿ƒè¡ŒåŠ¨æŒ‡å—ã€‚æ–‡ç« æ˜ç¡®æŒ‡å‡ºï¼Œæœªæ¥ä¼ä¸šçš„æ ¸å¿ƒå£å’ä¸å†æ˜¯æŸä¸ªæŠ€æœ¯ä¸“åˆ©ï¼Œè€Œæ˜¯èƒ½å¦åœ¨ç‰¹å®šé¢†åŸŸå†…æ„å»ºèµ·ä¸€ä¸ªé«˜æ•ˆçš„**å­¦ä¹ é—­ç¯**ï¼šç³»ç»Ÿåœ¨å®é™…è¿è¡Œä¸­**ä¸æ–­æ”¶é›†æ•°æ®ã€è·å–åé¦ˆã€ä¼˜åŒ–è¡¨ç°ï¼Œæœ€ç»ˆå½¢æˆè‡ªæˆ‘è¿›åŒ–çš„èƒ½åŠ›**ã€‚è¿™å¥—é€»è¾‘è§£é‡Šäº†ä¸ºä»€ä¹ˆ"å¿«è€…èƒœ"æ˜¯AIæ—¶ä»£çš„é“å¾‹ã€‚é¢†å…ˆè€…å‡­å€Ÿæ›´å¿«çš„è¿­ä»£é—­ç¯ï¼Œå…¶ä¼˜åŠ¿ä¼šå‘ˆæŒ‡æ•°çº§æ‰©å¤§ï¼Œå½¢æˆå¼ºå¤§çš„"è¿›åŒ–å‹å¼º"ã€‚äº§å“ç»ç†éœ€è¦æ€è€ƒï¼šæˆ‘ä»¬çš„äº§å“æ˜¯å¦å­˜åœ¨è¿™æ ·çš„é—­ç¯ï¼Ÿæ•°æ®é£è½®çš„é½¿è½®æ˜¯å¦éƒ½å·²å’¬åˆï¼Ÿ\n**3. æœ€ç»ˆçš„æ¼”åŒ–ï¼šAIæ­£åœ¨è„±ç¦»äººç±»è¯­ä¹‰æ¡†æ¶ï¼Œèµ°å‘"ç»“æ„ç”Ÿæˆ"**\nè¿™æ˜¯å¤§èƒ†ä¸”æœ€å‰æ²¿çš„æ´å¯Ÿã€‚æœªæ¥çš„AIå°†ä¸å†ä»…ä»…æ˜¯è§£å†³æˆ‘ä»¬ç»™å‡ºé—®é¢˜çš„å·¥å…·ï¼Œè€Œæ˜¯ä¼šæ¼”åŒ–ä¸ºèƒ½å¤Ÿ"è‡ªæˆ‘æé—®ã€è‡ªæˆ‘è§£ç­”ã€å¹¶å»ºç«‹æ”¯æ’‘é€»è¾‘"çš„æ™ºèƒ½ä¸»ä½“ã€‚"ç»“æ„ç”Ÿæˆ"ï¼ˆStructure Generationï¼‰å’Œ"é€»è¾‘æ”¯æ¶"ï¼ˆLogical Scaffoldingï¼‰è¿™äº›å…³é”®è¯ï¼Œæ„å‘³ç€è¯„åˆ¤ä¸€ä¸ªæ¨¡å‹å¼ºå¼±çš„æ ‡å‡†ï¼Œå°†ä»"è§£é¢˜èƒ½åŠ›"è·ƒè¿è‡³"å®šä¹‰é—®é¢˜å’Œæ„å»ºä½“ç³»çš„èƒ½åŠ›"ã€‚è¿™å¯¹æˆ‘ä»¬ç†è§£AGIçš„è·¯å¾„ï¼Œä»¥åŠå¦‚ä½•è¯„æµ‹ä¸‹ä¸€ä»£AIçš„èƒ½åŠ›ï¼Œæä¾›äº†å…¨æ–°çš„è§†è§’ã€‚\n"å­¦ä¹ é—­ç¯"å¯ä»¥ç»™åˆ°æ¯ä¸ªä¼ä¸šå’Œä¸ªäººå¯å‘ï¼š\n**å¯¹ä¼ä¸šå’Œäº§å“äººè€Œè¨€**ï¼ŒçœŸæ­£çš„æŠ¤åŸæ²³æ˜¯è¿™ä¸ªèƒ½æ»šé›ªçƒèˆ¬è‡ªæˆ‘ä¼˜åŒ–çš„æ•°æ®é£è½®ã€‚æ ¸å¿ƒä»»åŠ¡æ˜¯è®¾è®¡å‡ºè®©ç”¨æˆ·ä¹äºæä¾›é«˜è´¨é‡åé¦ˆçš„æœºåˆ¶ï¼Œå°†äº§å“ä»ä¸€æ¬¡æ€§äº¤ä»˜çš„åŠŸèƒ½ï¼Œå‡çº§ä¸ºèƒ½æŒç»­è¿›åŒ–çš„æœåŠ¡ã€‚\n**å¯¹æˆ‘ä»¬ä¸ªäººï¼Œ**åˆ™è¦æˆä¸ºèªæ˜çš„"AIè®­ç»ƒå¸ˆ"ï¼Œè€Œä¸åªæ˜¯è¢«åŠ¨ä½¿ç”¨è€…ã€‚é€šè¿‡æ¯ä¸€æ¬¡ä¿®æ­£ã€è¿½é—®å’Œä½¿ç”¨ä¸ªæ€§åŒ–æŒ‡ä»¤ï¼Œæˆ‘ä»¬éƒ½åœ¨æ„å»ºä¸€ä¸ªæœ€æ‡‚è‡ªå·±å·¥ä½œæµå’ŒçŸ¥è¯†èƒŒæ™¯çš„"ç¬¬äºŒå¤§è„‘"ï¼Œè¿™è¿œæ¯”ä»»ä½•é€šç”¨æ¨¡å‹éƒ½æ›´æœ‰ä»·å€¼ã€‚\nä½ çš„ä¼ä¸šä¸­æ˜¯å¦å·²ç»åœ¨éµå¾ª"å­¦ä¹ é—­ç¯"åŸåˆ™äº†ï¼Ÿè¿™ä¸ªç†å¿µèƒ½å¤Ÿå¯¹ä½ æ¥ä¸‹æ¥ä¸AIäº§å“å’Œå·¥å…·çš„äº¤äº’æœ‰ä»€ä¹ˆå¯å‘ï¼Ÿæ¬¢è¿äº¤æµ~\nè§†é¢‘é“¾æ¥ï¼šhttps://www.youtube.com/watch?v=qaPHK1fJL5s';
        // ========================================

        // ç»„åˆå®Œæ•´æ–‡æœ¬
        const fullText = subtitle + '\n' + content;

        let pages = [];
        let currentPage = 0;

        // è®¡ç®—æ–‡æœ¬åœ¨canvasä¸Šçš„å®é™…é«˜åº¦
        function calculateTextHeight(ctx, text, maxWidth, lineHeight) {
            // ç§»é™¤ç²—ä½“æ ‡è®°ä»¥ä¾¿æ­£ç¡®è®¡ç®—
            const cleanText = text.replace(/\*\*/g, '');
            const lines = cleanText.split('');
            let line = '';
            let lineCount = 0;
            
            for (let i = 0; i < lines.length; i++) {
                const testLine = line + lines[i];
                const metrics = ctx.measureText(testLine);
                
                if (metrics.width > maxWidth && line.length > 0) {
                    lineCount++;
                    line = lines[i];
                } else {
                    line = testLine;
                }
            }
            
            if (line.length > 0) {
                lineCount++;
            }
            
            return lineCount * lineHeight;
        }

        // å¤„ç†ç²—ä½“æ–‡æœ¬çš„å‡½æ•°
        function processAndDrawText(context, text, x, y, maxWidth, lineHeight) {
            const parts = text.split(/(\*\*.*?\*\*)/);
            let currentY = y;
            let currentX = x;
            let lineContent = '';
            
            context.save();
            context.textAlign = 'left';
            context.textBaseline = 'top';
            context.fillStyle = '#333333';
            
            for (const part of parts) {
                if (part.startsWith('**') && part.endsWith('**')) {
                    // ç²—ä½“æ–‡æœ¬
                    const boldText = part.slice(2, -2);
                    context.font = 'bold 28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢è¡Œ
                    const testLine = lineContent + boldText;
                    const metrics = context.measureText(testLine);
                    
                    if (metrics.width > maxWidth && lineContent.length > 0) {
                        // å…ˆç»˜åˆ¶å½“å‰è¡Œ
                        context.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                        context.fillText(lineContent, x, currentY);
                        currentY += lineHeight;
                        lineContent = '';
                        currentX = x;
                    }
                    
                    // ç»˜åˆ¶ç²—ä½“æ–‡æœ¬
                    context.font = 'bold 28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    const words = boldText.split('');
                    for (const word of words) {
                        const testWord = lineContent + word;
                        const wordMetrics = context.measureText(testWord);
                        
                        if (wordMetrics.width > maxWidth && lineContent.length > 0) {
                            context.fillText(lineContent, x, currentY);
                            currentY += lineHeight;
                            lineContent = word;
                        } else {
                            lineContent += word;
                        }
                    }
                } else {
                    // æ™®é€šæ–‡æœ¬
                    context.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    const words = part.split('');
                    
                    for (const word of words) {
                        const testWord = lineContent + word;
                        const wordMetrics = context.measureText(testWord);
                        
                        if (wordMetrics.width > maxWidth && lineContent.length > 0) {
                            context.fillText(lineContent, x, currentY);
                            currentY += lineHeight;
                            lineContent = word;
                        } else {
                            lineContent += word;
                        }
                    }
                }
            }
            
            // ç»˜åˆ¶æœ€åä¸€è¡Œ
            if (lineContent.length > 0) {
                context.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                context.fillText(lineContent, x, currentY);
                currentY += lineHeight;
            }
            
            context.restore();
            return currentY;
        }

        // ä¿®å¤åçš„å·¦å¯¹é½ç»˜åˆ¶å‡½æ•°
        function drawLeftAlignedText(context, text, x, y, maxWidth, lineHeight) {
            context.save();
            
            const currentFont = context.font;
            if (currentFont.includes('bold')) {
                context.font = 'bold 36px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
            } else {
                context.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
            }
            
            context.textAlign = 'left';
            context.textBaseline = 'top';
            
            const isURL = text.match(/^https?:\/\//);
            context.fillStyle = isURL ? '#666666' : '#333333';
            
            let line = '';
            let currentY = y;
            
            for (let i = 0; i < text.length; i++) {
                const testLine = line + text[i];
                const metrics = context.measureText(testLine);
                
                if (metrics.width > maxWidth && line.length > 0) {
                    context.fillText(line, x, currentY);
                    line = text[i];
                    currentY += lineHeight;
                } else {
                    line = testLine;
                }
            }
            
            if (line.length > 0) {
                context.fillText(line, x, currentY);
                currentY += lineHeight;
            }
            
            context.restore();
            
            return currentY;
        }

        // ç»˜åˆ¶æ ‡é¢˜çš„å‡½æ•°
        function drawTitle(context, x, y, maxWidth) {
            context.save();
            
            context.font = 'bold 72px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
            context.fillStyle = '#333333';
            context.textAlign = 'center';
            context.textBaseline = 'top';
            
            const title = 'AIäº§å“ç»ç†çš„è¡Œä¸šæ—¥æŠ¥';
            context.fillText(title, 450, y);
            
            context.restore();
            
            return y + 100;
        }

        function splitTextIntoPages() {
            const canvas = document.getElementById('renderCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 900;
            canvas.height = 1200;
            
            const maxHeight = 1050; // ç•™å‡ºåº•éƒ¨é¡µç ç©ºé—´
            const x = 50;
            const maxWidth = 800;
            
            const lines = fullText.split('\n');
            pages = [];
            let currentPageLines = [];
            let currentHeight = 80;
            
            // ç¬¬ä¸€é¡µéœ€è¦é¢å¤–è€ƒè™‘æ ‡é¢˜é«˜åº¦
            let isFirstPage = true;
            if (isFirstPage) {
                currentHeight = 180; // ä¸ºæ ‡é¢˜é¢„ç•™ç©ºé—´
            }
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                let lineHeight = 48;
                let extraSpacing = 0;
                
                // ä¸ºå°æ ‡é¢˜è®¾ç½®æ ·å¼
                if (line === subtitle) {
                    ctx.font = 'bold 36px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    lineHeight = 54;
                    extraSpacing = 10; // å°æ ‡é¢˜å‰çš„é¢å¤–é—´è·
                } else {
                    ctx.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                }
                
                // è®¡ç®—è¿™ä¸€è¡Œéœ€è¦çš„é«˜åº¦
                let estimatedHeight = lineHeight;
                if (line.trim()) {
                    // å¦‚æœåŒ…å«ç²—ä½“ï¼Œéœ€è¦æ›´å‡†ç¡®çš„è®¡ç®—
                    const cleanLine = line.replace(/\*\*/g, '');
                    estimatedHeight = calculateTextHeight(ctx, cleanLine, maxWidth, lineHeight);
                } else {
                    // ç©ºè¡Œ
                    estimatedHeight = 24;
                }
                
                // åŠ ä¸Šé¢å¤–é—´è·
                estimatedHeight += extraSpacing;
                
                // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ†é¡µ
                if (currentHeight + estimatedHeight > maxHeight) {
                    // éœ€è¦æ–°å»ºä¸€é¡µ
                    if (currentPageLines.length > 0) {
                        pages.push(currentPageLines.join('\n'));
                        currentPageLines = [];
                        currentHeight = 80; // é‡ç½®é«˜åº¦
                        isFirstPage = false;
                    }
                }
                
                // æ·»åŠ å½“å‰è¡Œåˆ°å½“å‰é¡µ
                currentPageLines.push(line);
                currentHeight += estimatedHeight;
            }
            
            // æ·»åŠ æœ€åä¸€é¡µ
            if (currentPageLines.length > 0) {
                pages.push(currentPageLines.join('\n'));
            }
            
            console.log('æ€»å…±åˆ†æˆäº† ' + pages.length + ' é¡µ');
        }

        function renderPage(pageIndex) {
            const canvas = document.getElementById('renderCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 900;
            canvas.height = 1200;
            
            // ç™½è‰²èƒŒæ™¯
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            let y = 80;
            const x = 50;
            const maxWidth = 800;
            
            // å¦‚æœæ˜¯ç¬¬ä¸€é¡µï¼Œç»˜åˆ¶æ ‡é¢˜
            if (pageIndex === 0) {
                y = drawTitle(ctx, x, 50, maxWidth);
                y += 30;
            }
            
            // ç»˜åˆ¶å†…å®¹
            const lines = pages[pageIndex].split('\n');
            
            lines.forEach(line => {
                if (line === subtitle) {
                    // å°æ ‡é¢˜å‰å¢åŠ é—´è·
                    y += 10;
                    ctx.font = 'bold 36px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    y = drawLeftAlignedText(ctx, line, x, y, maxWidth, 54);
                } else if (line.trim()) {
                    // æ£€æŸ¥æ˜¯å¦åŒ…å«ç²—ä½“æ ‡è®°
                    if (line.includes('**')) {
                        y = processAndDrawText(ctx, line, x, y, maxWidth, 48);
                    } else {
                        ctx.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                        y = drawLeftAlignedText(ctx, line, x, y, maxWidth, 48);
                    }
                } else {
                    y += 24;
                }
            });
            
            // é¡µç 
            ctx.save();
            ctx.fillStyle = '#999999';
            ctx.font = '20px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'top';
            ctx.fillText((pageIndex + 1) + '/' + pages.length, 850, 1150);
            ctx.restore();
        }

        function downloadCanvasAsImage(pageIndex) {
            const canvas = document.getElementById('renderCanvas');
            canvas.toBlob(blob => {
                const link = document.createElement('a');
                link.download = 'AIæ—¥æŠ¥_ç¬¬' + (pageIndex + 1) + 'é¡µ.png';
                link.href = URL.createObjectURL(blob);
                link.click();
                URL.revokeObjectURL(link.href);
            });
        }

        function generateWithCanvas() {
            if (pages.length === 0) splitTextIntoPages();
            
            updateStatus('<span class="loading"></span>æ­£åœ¨ç”Ÿæˆç¬¬1é¡µ...');
            renderPage(0);
            
            setTimeout(() => {
                downloadCanvasAsImage(0);
                updateStatus('ç”Ÿæˆå®Œæˆï¼ç‚¹å‡»é¢„è§ˆå¡ç‰‡å¯ç”Ÿæˆå…¶ä»–é¡µé¢');
            }, 100);
        }

        async function generateAllCanvasImages() {
            if (pages.length === 0) splitTextIntoPages();
            
            for (let i = 0; i < pages.length; i++) {
                updateStatus('<span class="loading"></span>æ­£åœ¨ç”Ÿæˆç¬¬' + (i + 1) + '/' + pages.length + 'é¡µ...');
                renderPage(i);
                
                await new Promise(resolve => {
                    setTimeout(() => {
                        downloadCanvasAsImage(i);
                        resolve();
                    }, 500);
                });
            }
            
            updateStatus('æ‰€æœ‰å›¾ç‰‡ç”Ÿæˆå®Œæˆï¼');
        }

        function createPreviewCards() {
            splitTextIntoPages();
            const container = document.getElementById('cardContainer');
            container.innerHTML = ''; // æ¸…ç©ºå®¹å™¨
            
            pages.forEach((pageContent, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'card-wrapper';
                
                const card = document.createElement('div');
                card.className = 'preview-card';
                card.onclick = () => {
                    updateStatus('<span class="loading"></span>æ­£åœ¨ç”Ÿæˆç¬¬' + (index + 1) + 'é¡µ...');
                    renderPage(index);
                    setTimeout(() => {
                        downloadCanvasAsImage(index);
                        updateStatus('ç”Ÿæˆå®Œæˆï¼');
                    }, 100);
                };
                
                const content = document.createElement('div');
                content.className = 'preview-content';
                
                // å¦‚æœæ˜¯ç¬¬ä¸€é¡µï¼Œåœ¨é¢„è§ˆä¸­ä¹Ÿæ˜¾ç¤ºæ ‡é¢˜
                let displayContent = pageContent;
                if (index === 0) {
                    displayContent = '<strong style="font-size: 16px; display: block; text-align: center; margin-bottom: 15px;">AIäº§å“ç»ç†çš„è¡Œä¸šæ—¥æŠ¥</strong>' + pageContent;
                }
                
                content.innerHTML = displayContent
                    .replace(/\n/g, '<br>')
                    .replace(new RegExp(subtitle.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), '<strong style="font-size: 14px; color: #1976d2;">' + subtitle + '</strong>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/(https?:\/\/[^\s<]+)/g, '<span style="color: #666666;">$1</span>');
                
                const pageNumber = document.createElement('div');
                pageNumber.className = 'preview-page-number';
                pageNumber.textContent = (index + 1) + '/' + pages.length;
                
                card.appendChild(content);
                card.appendChild(pageNumber);
                
                const label = document.createElement('div');
                label.className = 'card-label';
                label.textContent = 'ç¬¬ ' + (index + 1) + ' é¡µ - ç‚¹å‡»ç”Ÿæˆå›¾ç‰‡';
                
                wrapper.appendChild(label);
                wrapper.appendChild(card);
                container.appendChild(wrapper);
            });
        }

        function updateStatus(message) {
            document.getElementById('status').innerHTML = message;
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            createPreviewCards();
            updateStatus('å‡†å¤‡å°±ç»ªï¼Œå…± ' + pages.length + ' é¡µ');
        };
    </script>
</body>
</html>