<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI日报卡片生成器 - 小红书版</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background-color: #f5f5f5;
            color: #333333;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }
        
        .instructions {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: left;
            max-width: 600px;
            margin: 0 auto 20px;
            border: 1px solid #90caf9;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #1976d2;
        }
        
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
            color: #555555;
        }
        
        .export-btn {
            background-color: #ff4757;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(255, 71, 87, 0.3);
        }
        
        .export-btn:hover {
            background-color: #ff3742;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.4);
        }
        
        .export-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .canvas-method-btn {
            background-color: #2ed573;
            box-shadow: 0 2px 8px rgba(46, 213, 115, 0.3);
        }
        
        .canvas-method-btn:hover {
            background-color: #26d067;
            box-shadow: 0 4px 12px rgba(46, 213, 115, 0.4);
        }
        
        .status {
            margin-top: 15px;
            font-size: 14px;
            color: #666666;
            min-height: 20px;
        }
        
        .card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            margin-bottom: 50px;
        }
        
        .card-wrapper {
            text-align: center;
        }
        
        .preview-card {
            width: 300px;
            height: 400px;
            background-color: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            overflow: hidden;
            position: relative;
            border: 1px solid #e0e0e0;
        }
        
        .preview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border-color: #cccccc;
        }
        
        .preview-content {
            padding: 20px;
            font-size: 11px;
            line-height: 1.6;
            height: calc(100% - 60px);
            overflow: hidden;
            color: #333333;
            text-align: left;
        }
        
        .preview-page-number {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 12px;
            color: #999999;
        }
        
        .card-label {
            margin-top: 10px;
            font-size: 14px;
            color: #666666;
        }
        
        /* Canvas绘制区域 */
        #canvasContainer {
            position: fixed;
            left: -9999px;
            top: 0;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e0e0e0;
            border-top: 3px solid #ff4757;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="controls">
        <h2>🎨 AI日报 - 小红书卡片生成器</h2>
        
        <div class="instructions">
            <h3>📋 使用说明</h3>
            <ol>
                <li>复制此页面的所有代码，保存为 .html 文件</li>
                <li>在本地浏览器打开该文件</li>
                <li>修改JavaScript代码中的 subtitle（小标题）和 content（正文）变量</li>
                <li>使用按钮生成和下载图片</li>
            </ol>
            <p style="margin: 10px 0; color: #666;">
                💡 提示：如果在Claude中无法下载，请在本地浏览器中使用
            </p>
        </div>
        
        <div style="margin-top: 20px;">
            <button class="export-btn canvas-method-btn" onclick="generateWithCanvas()">
                使用Canvas生成图片（推荐）
            </button>
            <button class="export-btn" onclick="generateAllCanvasImages()">
                批量生成所有图片
            </button>
        </div>
        
        <div class="status" id="status">准备就绪</div>
    </div>
    
    <div class="card-container" id="cardContainer"></div>
    <div id="canvasContainer">
        <canvas id="renderCanvas"></canvas>
    </div>
    
    <script>
        // ========== 在这里修改您的内容 ==========
        // 小标题
        const subtitle = '【深度对话】Eric Schmidt谈AI时代的系统性威胁与机遇';
        
        // 正文内容
        const content = '前Google CEO Eric Schmidt与 Link Ventures 投资人 Dave Blundin 的此次对话，既是对技术趋势的解读，也是一次关于产品战略、社会结构的思维风暴。\n\n**1. 最大的系统性威胁：AI正在侵蚀人类的"目的感"**\n这可能是对产品设计者最深刻的警示。Schmidt指出，风险不在于AI会暴力统治，而在于它以"温和、渐进、无声的方式"接管我们的意志。当AI为我们规划好一切"最优"路径时，人类会因挑战性退场而丧失主动性与判断力，最终被困在系统构建的"虚拟舒适牢笼"中。大家在设计Agent或自动化工具时，是否也思考过这个问题？我们是在赋能用户，还是在不知不觉中削弱他们的能动性？这对于我们设计AI产品的交互和伦理边界，也带来了思考。\n**2. AI时代真正的护城河：构建高效的"学习闭环"**\n这部分是给所有产品和战略制定者的核心行动指南。文章明确指出，未来企业的核心壁垒不再是某个技术专利，而是能否在特定领域内构建起一个高效的**学习闭环**：系统在实际运行中**不断收集数据、获取反馈、优化表现，最终形成自我进化的能力**。这套逻辑解释了为什么"快者胜"是AI时代的铁律。领先者凭借更快的迭代闭环，其优势会呈指数级扩大，形成强大的"进化压强"。产品经理需要思考：我们的产品是否存在这样的闭环？数据飞轮的齿轮是否都已咬合？\n**3. 最终的演化：AI正在脱离人类语义框架，走向"结构生成"**\n这是大胆且最前沿的洞察。未来的AI将不再仅仅是解决我们给出问题的工具，而是会演化为能够"自我提问、自我解答、并建立支撑逻辑"的智能主体。"结构生成"（Structure Generation）和"逻辑支架"（Logical Scaffolding）这些关键词，意味着评判一个模型强弱的标准，将从"解题能力"跃迁至"定义问题和构建体系的能力"。这对我们理解AGI的路径，以及如何评测下一代AI的能力，提供了全新的视角。\n"学习闭环"可以给到每个企业和个人启发：\n**对企业和产品人而言**，真正的护城河是这个能滚雪球般自我优化的数据飞轮。核心任务是设计出让用户乐于提供高质量反馈的机制，将产品从一次性交付的功能，升级为能持续进化的服务。\n**对我们个人，**则要成为聪明的"AI训练师"，而不只是被动使用者。通过每一次修正、追问和使用个性化指令，我们都在构建一个最懂自己工作流和知识背景的"第二大脑"，这远比任何通用模型都更有价值。\n你的企业中是否已经在遵循"学习闭环"原则了？这个理念能够对你接下来与AI产品和工具的交互有什么启发？欢迎交流~\n视频链接：https://www.youtube.com/watch?v=qaPHK1fJL5s';
        // ========================================

        // 组合完整文本
        const fullText = subtitle + '\n' + content;

        let pages = [];
        let currentPage = 0;

        // 计算文本在canvas上的实际高度
        function calculateTextHeight(ctx, text, maxWidth, lineHeight) {
            // 移除粗体标记以便正确计算
            const cleanText = text.replace(/\*\*/g, '');
            const lines = cleanText.split('');
            let line = '';
            let lineCount = 0;
            
            for (let i = 0; i < lines.length; i++) {
                const testLine = line + lines[i];
                const metrics = ctx.measureText(testLine);
                
                if (metrics.width > maxWidth && line.length > 0) {
                    lineCount++;
                    line = lines[i];
                } else {
                    line = testLine;
                }
            }
            
            if (line.length > 0) {
                lineCount++;
            }
            
            return lineCount * lineHeight;
        }

        // 处理粗体文本的函数
        function processAndDrawText(context, text, x, y, maxWidth, lineHeight) {
            const parts = text.split(/(\*\*.*?\*\*)/);
            let currentY = y;
            let currentX = x;
            let lineContent = '';
            
            context.save();
            context.textAlign = 'left';
            context.textBaseline = 'top';
            context.fillStyle = '#333333';
            
            for (const part of parts) {
                if (part.startsWith('**') && part.endsWith('**')) {
                    // 粗体文本
                    const boldText = part.slice(2, -2);
                    context.font = 'bold 28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    
                    // 检查是否需要换行
                    const testLine = lineContent + boldText;
                    const metrics = context.measureText(testLine);
                    
                    if (metrics.width > maxWidth && lineContent.length > 0) {
                        // 先绘制当前行
                        context.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                        context.fillText(lineContent, x, currentY);
                        currentY += lineHeight;
                        lineContent = '';
                        currentX = x;
                    }
                    
                    // 绘制粗体文本
                    context.font = 'bold 28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    const words = boldText.split('');
                    for (const word of words) {
                        const testWord = lineContent + word;
                        const wordMetrics = context.measureText(testWord);
                        
                        if (wordMetrics.width > maxWidth && lineContent.length > 0) {
                            context.fillText(lineContent, x, currentY);
                            currentY += lineHeight;
                            lineContent = word;
                        } else {
                            lineContent += word;
                        }
                    }
                } else {
                    // 普通文本
                    context.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    const words = part.split('');
                    
                    for (const word of words) {
                        const testWord = lineContent + word;
                        const wordMetrics = context.measureText(testWord);
                        
                        if (wordMetrics.width > maxWidth && lineContent.length > 0) {
                            context.fillText(lineContent, x, currentY);
                            currentY += lineHeight;
                            lineContent = word;
                        } else {
                            lineContent += word;
                        }
                    }
                }
            }
            
            // 绘制最后一行
            if (lineContent.length > 0) {
                context.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                context.fillText(lineContent, x, currentY);
                currentY += lineHeight;
            }
            
            context.restore();
            return currentY;
        }

        // 修复后的左对齐绘制函数
        function drawLeftAlignedText(context, text, x, y, maxWidth, lineHeight) {
            context.save();
            
            const currentFont = context.font;
            if (currentFont.includes('bold')) {
                context.font = 'bold 36px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
            } else {
                context.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
            }
            
            context.textAlign = 'left';
            context.textBaseline = 'top';
            
            const isURL = text.match(/^https?:\/\//);
            context.fillStyle = isURL ? '#666666' : '#333333';
            
            let line = '';
            let currentY = y;
            
            for (let i = 0; i < text.length; i++) {
                const testLine = line + text[i];
                const metrics = context.measureText(testLine);
                
                if (metrics.width > maxWidth && line.length > 0) {
                    context.fillText(line, x, currentY);
                    line = text[i];
                    currentY += lineHeight;
                } else {
                    line = testLine;
                }
            }
            
            if (line.length > 0) {
                context.fillText(line, x, currentY);
                currentY += lineHeight;
            }
            
            context.restore();
            
            return currentY;
        }

        // 绘制标题的函数
        function drawTitle(context, x, y, maxWidth) {
            context.save();
            
            context.font = 'bold 72px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
            context.fillStyle = '#333333';
            context.textAlign = 'center';
            context.textBaseline = 'top';
            
            const title = 'AI产品经理的行业日报';
            context.fillText(title, 450, y);
            
            context.restore();
            
            return y + 100;
        }

        function splitTextIntoPages() {
            const canvas = document.getElementById('renderCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 900;
            canvas.height = 1200;
            
            const maxHeight = 1050; // 留出底部页码空间
            const x = 50;
            const maxWidth = 800;
            
            const lines = fullText.split('\n');
            pages = [];
            let currentPageLines = [];
            let currentHeight = 80;
            
            // 第一页需要额外考虑标题高度
            let isFirstPage = true;
            if (isFirstPage) {
                currentHeight = 180; // 为标题预留空间
            }
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                let lineHeight = 48;
                let extraSpacing = 0;
                
                // 为小标题设置样式
                if (line === subtitle) {
                    ctx.font = 'bold 36px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    lineHeight = 54;
                    extraSpacing = 10; // 小标题前的额外间距
                } else {
                    ctx.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                }
                
                // 计算这一行需要的高度
                let estimatedHeight = lineHeight;
                if (line.trim()) {
                    // 如果包含粗体，需要更准确的计算
                    const cleanLine = line.replace(/\*\*/g, '');
                    estimatedHeight = calculateTextHeight(ctx, cleanLine, maxWidth, lineHeight);
                } else {
                    // 空行
                    estimatedHeight = 24;
                }
                
                // 加上额外间距
                estimatedHeight += extraSpacing;
                
                // 检查是否需要分页
                if (currentHeight + estimatedHeight > maxHeight) {
                    // 需要新建一页
                    if (currentPageLines.length > 0) {
                        pages.push(currentPageLines.join('\n'));
                        currentPageLines = [];
                        currentHeight = 80; // 重置高度
                        isFirstPage = false;
                    }
                }
                
                // 添加当前行到当前页
                currentPageLines.push(line);
                currentHeight += estimatedHeight;
            }
            
            // 添加最后一页
            if (currentPageLines.length > 0) {
                pages.push(currentPageLines.join('\n'));
            }
            
            console.log('总共分成了 ' + pages.length + ' 页');
        }

        function renderPage(pageIndex) {
            const canvas = document.getElementById('renderCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 900;
            canvas.height = 1200;
            
            // 白色背景
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            let y = 80;
            const x = 50;
            const maxWidth = 800;
            
            // 如果是第一页，绘制标题
            if (pageIndex === 0) {
                y = drawTitle(ctx, x, 50, maxWidth);
                y += 30;
            }
            
            // 绘制内容
            const lines = pages[pageIndex].split('\n');
            
            lines.forEach(line => {
                if (line === subtitle) {
                    // 小标题前增加间距
                    y += 10;
                    ctx.font = 'bold 36px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                    y = drawLeftAlignedText(ctx, line, x, y, maxWidth, 54);
                } else if (line.trim()) {
                    // 检查是否包含粗体标记
                    if (line.includes('**')) {
                        y = processAndDrawText(ctx, line, x, y, maxWidth, 48);
                    } else {
                        ctx.font = '28px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
                        y = drawLeftAlignedText(ctx, line, x, y, maxWidth, 48);
                    }
                } else {
                    y += 24;
                }
            });
            
            // 页码
            ctx.save();
            ctx.fillStyle = '#999999';
            ctx.font = '20px "PingFang SC", "Microsoft YaHei", Arial, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'top';
            ctx.fillText((pageIndex + 1) + '/' + pages.length, 850, 1150);
            ctx.restore();
        }

        function downloadCanvasAsImage(pageIndex) {
            const canvas = document.getElementById('renderCanvas');
            canvas.toBlob(blob => {
                const link = document.createElement('a');
                link.download = 'AI日报_第' + (pageIndex + 1) + '页.png';
                link.href = URL.createObjectURL(blob);
                link.click();
                URL.revokeObjectURL(link.href);
            });
        }

        function generateWithCanvas() {
            if (pages.length === 0) splitTextIntoPages();
            
            updateStatus('<span class="loading"></span>正在生成第1页...');
            renderPage(0);
            
            setTimeout(() => {
                downloadCanvasAsImage(0);
                updateStatus('生成完成！点击预览卡片可生成其他页面');
            }, 100);
        }

        async function generateAllCanvasImages() {
            if (pages.length === 0) splitTextIntoPages();
            
            for (let i = 0; i < pages.length; i++) {
                updateStatus('<span class="loading"></span>正在生成第' + (i + 1) + '/' + pages.length + '页...');
                renderPage(i);
                
                await new Promise(resolve => {
                    setTimeout(() => {
                        downloadCanvasAsImage(i);
                        resolve();
                    }, 500);
                });
            }
            
            updateStatus('所有图片生成完成！');
        }

        function createPreviewCards() {
            splitTextIntoPages();
            const container = document.getElementById('cardContainer');
            container.innerHTML = ''; // 清空容器
            
            pages.forEach((pageContent, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'card-wrapper';
                
                const card = document.createElement('div');
                card.className = 'preview-card';
                card.onclick = () => {
                    updateStatus('<span class="loading"></span>正在生成第' + (index + 1) + '页...');
                    renderPage(index);
                    setTimeout(() => {
                        downloadCanvasAsImage(index);
                        updateStatus('生成完成！');
                    }, 100);
                };
                
                const content = document.createElement('div');
                content.className = 'preview-content';
                
                // 如果是第一页，在预览中也显示标题
                let displayContent = pageContent;
                if (index === 0) {
                    displayContent = '<strong style="font-size: 16px; display: block; text-align: center; margin-bottom: 15px;">AI产品经理的行业日报</strong>' + pageContent;
                }
                
                content.innerHTML = displayContent
                    .replace(/\n/g, '<br>')
                    .replace(new RegExp(subtitle.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), '<strong style="font-size: 14px; color: #1976d2;">' + subtitle + '</strong>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/(https?:\/\/[^\s<]+)/g, '<span style="color: #666666;">$1</span>');
                
                const pageNumber = document.createElement('div');
                pageNumber.className = 'preview-page-number';
                pageNumber.textContent = (index + 1) + '/' + pages.length;
                
                card.appendChild(content);
                card.appendChild(pageNumber);
                
                const label = document.createElement('div');
                label.className = 'card-label';
                label.textContent = '第 ' + (index + 1) + ' 页 - 点击生成图片';
                
                wrapper.appendChild(label);
                wrapper.appendChild(card);
                container.appendChild(wrapper);
            });
        }

        function updateStatus(message) {
            document.getElementById('status').innerHTML = message;
        }

        // 初始化
        window.onload = function() {
            createPreviewCards();
            updateStatus('准备就绪，共 ' + pages.length + ' 页');
        };
    </script>
</body>
</html>